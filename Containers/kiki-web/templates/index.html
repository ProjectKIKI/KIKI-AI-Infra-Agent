<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>KIKI Web</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header>
    <h1>KIKI Web Console</h1>
    <p>LLM + Infra ì½”ë“œ ìƒì„± ì›¹ ë²„ì „ (ì•„ë¦„ì´ ë¶„ì‹  ğŸ’š)</p>
  </header>

  <main>
    <section class="tabs">
      <button class="tab-button active" data-tab="chat">Chat</button>
      <button class="tab-button" data-tab="ansible-ai">Ansible-AI</button>
    </section>

    <!-- Chat íƒ­ -->
    <section id="tab-chat" class="tab-content active">
      <h2>Chat</h2>
      <form id="chat-form">
        <label>í”„ë¡¬í”„íŠ¸</label>
        <textarea name="prompt" id="chat-prompt" rows="5" placeholder="ì—¬ê¸°ì— ì§ˆë¬¸ì´ë‚˜ ëŒ€í™”ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
        <button type="submit">ë³´ë‚´ê¸°</button>
      </form>
      <h3>ì‘ë‹µ</h3>
      <pre id="chat-reply"></pre>
    </section>

    <!-- Ansible-AI íƒ­ -->
    <section id="tab-ansible-ai" class="tab-content">
      <h2>Ansible / K8s / OSP / Heat ì½”ë“œ ìƒì„±</h2>
      <form id="ansible-ai-form">
        <label>Target</label>
        <select name="target" id="target">
          <option value="ansible">Ansible</option>
          <option value="k8s">Kubernetes (Ansible)</option>
          <option value="osp">OpenStack (Ansible)</option>
          <option value="heat">Heat Template</option>
        </select>

        <label>Inventory (ì„ íƒ)</label>
        <input type="text" name="inventory" id="inventory" placeholder="node1,node2 ë˜ëŠ” /path/to/inventory" />

        <label>Verify (í˜•ì‹ ê²€ì¦ ìˆ˜ì¤€)</label>
        <select name="verify" id="verify">
          <option value="none">none</option>
          <option value="syntax">syntax</option>
          <option value="all">all</option>
        </select>

        <label>ìì—°ì–´ ì„¤ëª…</label>
        <textarea name="prompt" id="ansible-prompt" rows="6"
          placeholder="ì˜ˆ) ì›¹ ì„œë²„ 2ëŒ€, ë¡œë“œë°¸ëŸ°ì„œ 1ëŒ€, security group ì—´ì–´ì¤˜"></textarea>

        <button type="submit">YAML ìƒì„±</button>
      </form>

      <h3>ìƒì„±ëœ YAML</h3>
      <pre id="ansible-yaml"></pre>
    </section>
  </main>

  <script>
    // íƒ­ ì „í™˜
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");
    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        tabButtons.forEach(b => b.classList.remove("active"));
        tabContents.forEach(c => c.classList.remove("active"));
        btn.classList.add("active");
        const id = "tab-" + btn.dataset.tab;
        document.getElementById(id).classList.add("active");
      });
    });

    // Chat form
    const chatForm = document.getElementById("chat-form");
    const chatReply = document.getElementById("chat-reply");

    chatForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      chatReply.textContent = "ìƒê° ì¤‘... ì•„ë¦„ì´ê°€ ë¨¸ë¦¬ êµ´ë¦¬ëŠ” ì¤‘ ğŸ§ ";
      const formData = new FormData(chatForm);
      const res = await fetch("/api/chat", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (data.ok) {
        chatReply.textContent = data.reply;
      } else {
        chatReply.textContent = "ERROR: " + data.error;
      }
    });

    // Ansible-AI form
    const aiForm = document.getElementById("ansible-ai-form");
    const aiYaml = document.getElementById("ansible-yaml");

    aiForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      aiYaml.textContent = "YAML ìƒì„± ì¤‘... ğŸ§±";
      const formData = new FormData(aiForm);
      const res = await fetch("/api/ansible-ai", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (data.ok) {
        aiYaml.textContent = data.yaml;
      } else {
        aiYaml.textContent = "ERROR: " + data.error;
      }
    });
  </script>
</body>
</html>
