# Containerfile.web
FROM python:3.11-slim

ENV PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    LANG=C.UTF-8

# 필요한 패키지 (빌드 툴 조금 + curl 정도)
RUN apt-get update && \
    apt-get install -y --no-install-recommends build-essential curl && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Python 의존성
RUN python -m pip install --upgrade pip && \
    python -m pip install fastapi "uvicorn[standard]" jinja2 requests python-multipart && \
    python -m pip install python-multipart

COPY Containers/kiki-web/app.py Containers/kiki-web/kiki_core.py /app/
COPY Containers/kiki-web/templates /app/templates
COPY Containers/kiki-web/static /app/static

ENV KIKI_LLM_BASE_URL=\"http://127.0.0.1:8080\" \
    KIKI_LLM_MODEL=\"local-llama\"

EXPOSE 8090

CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8090"]