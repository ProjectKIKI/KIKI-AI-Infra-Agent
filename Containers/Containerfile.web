# Containerfile.web
FROM python:3.11-slim

ENV PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    LANG=C.UTF-8

# 필요한 패키지 (빌드 툴 조금 + curl 정도)
RUN apt-get update && \
    apt-get install -y --no-install-recommends build-essential curl && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Python 의존성
# (필요 시 requirements.txt로 분리 가능)
RUN python -m pip install --upgrade pip && \
    python -m pip install fastapi uvicorn jinja2 requests

# 애플리케이션 복사
# (로컬에서 빌드할 때 이 파일들이 있는 디렉터리에서 podman build 실행)
COPY app.py kiki_core.py /app/
COPY templates /app/templates
COPY static /app/static

# 기본 환경변수 (Pod에서 override 가능)
ENV KIKI_LLM_BASE_URL="http://127.0.0.1:8080" \
    KIKI_LLM_MODEL="local-llama"

EXPOSE 8090

# prod 모드용 uvicorn 실행
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8090"]
